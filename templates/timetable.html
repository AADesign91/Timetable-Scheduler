<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Generated Timetable</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css"
  />
  <style>
    body {
      background: #f1f5f9;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 20px;
    }

    .app-card {
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
      padding: 20px;
      margin-bottom: 20px;
    }

    .timetable-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }

    .timetable-table th,
    .timetable-table td {
      border: 1px solid #e2e8f0;
      padding: 4px;
      text-align: center;
      min-width: 70px;
    }

    .timetable-table th {
      background: #e0ebff;
      position: sticky;
      top: 0;
      z-index: 1;
    }

    .time-col {
      background: #f8fafc;
      font-weight: 600;
      position: sticky;
      left: 0;
      z-index: 2;
    }

    .slot-empty {
      background: #f8fafc;
      color: #94a3b8;
    }

    .slot {
      border-radius: 10px;
      padding: 2px 4px;
      display: inline-block;
      min-width: 55px;
    }

    .color-1 { background: #bfdbfe; color: #1e3a8a; }
    .color-2 { background: #fde68a; color: #92400e; }
    .color-3 { background: #bbf7d0; color: #166534; }
    .color-4 { background: #fecaca; color: #7f1d1d; }
    .color-5 { background: #e9d5ff; color: #5b21b6; }
    .color-6 { background: #f9a8d4; color: #831843; }
    .color-7 { background: #99f6e4; color: #115e59; }
    .color-8 { background: #fed7aa; color: #9a3412; }

    .pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.75rem;
      background: #e0f2fe;
      color: #0369a1;
      margin-right: 4px;
    }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3 class="mb-0">Generated Timetable</h3>
      <a href="/" class="btn btn-sm btn-outline-secondary">← Back to editor</a>
    </div>

    <div class="row">
      <div class="col-md-8">
        <div class="app-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">Schedule</h5>
            <span class="text-muted" style="font-size: 0.8rem;">
              Use case: {{ use_case }} • Template: {{ schedule_template }}
            </span>
          </div>
          <div style="overflow:auto; max-height: 500px;">
            <table class="timetable-table">
              <thead>
                <tr>
                  <th class="time-col">Time / Day</th>
                  <th>Day 1</th>
                  <th>Day 2</th>
                  <th>Day 3</th>
                  <th>Day 4</th>
                  <th>Day 5</th>
                  <th>Day 6</th>
                </tr>
              </thead>
              <tbody>
                {% set days = ['Day1','Day2','Day3','Day4','Day5','Day6'] %}
                {% if timetable %}
                  {% set any_day = days[0] %}
                  {% set slots = timetable[any_day].keys() %}
                  {% for time in slots %}
                  <tr>
                    <td class="time-col">{{ time }}</td>
                    {% for day in days %}
                      {% set client_name = timetable[day][time] %}
                      {% if client_name %}
                        {% set cc = student_colors.get(client_name, 'slot-empty') %}
                        <td>
                          <span class="slot {{ cc }}">{{ client_name }}</span>
                        </td>
                      {% else %}
                        <td class="slot-empty"></td>
                      {% endif %}
                    {% endfor %}
                  </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="7" class="text-center text-muted">
                      No timetable data.
                    </td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="app-card mb-3">
          <h5>Conflicts</h5>
          {% if conflicts %}
            <ul class="mb-0">
              {% for c in conflicts %}
                <li>{{ c }}</li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">No conflicts detected.</p>
          {% endif %}
        </div>

        <div class="app-card">
          <h5>Client Summary</h5>
          {% if summary %}
            <ul class="mb-0 list-unstyled">
              {% for name, info in summary.items() %}
                {% set cc = student_colors.get(name, 'slot-empty') %}
                <li class="mb-1">
                  <span class="pill {{ cc }}">{{ name }}</span>
                  <span class="text-muted" style="font-size: 0.8rem;">
                    {{ info.scheduled }} / {{ info.needed }} sessions scheduled
                  </span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">No summary available.</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</body>
</html>
